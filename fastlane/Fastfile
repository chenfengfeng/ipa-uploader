# 這是一個 Fastfile，使用 Ruby 語法

# 預設平台為 iOS
default_platform(:ios)

platform :ios do
  # 定義一個名為 'upload' 的通道 (lane)
  desc "Upload IPA to App Store Connect"
  lane :upload do
    
    # ⭐️ 關鍵改動：從環境變數中讀取 API Key 資訊，並組合成一個 hash
    api_key = AppStoreConnectAPIKey.from_env
    
    # 在當前目錄中尋找 .ipa 檔案的路徑
    ipa_path = Dir.glob("*.ipa").first
    
    # 執行上傳動作，並明確傳入 api_key 參數
    upload_to_app_store(
      api_key: api_key,
      ipa: ipa_path
    )
    
  end
end
